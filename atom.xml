<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Nils Hayat]]></title>
  <link href="http://nilsou.com/atom.xml" rel="self"/>
  <link href="http://nilsou.com/"/>
  <updated>2013-08-21T11:50:38-04:00</updated>
  <id>http://nilsou.com/</id>
  <author>
    <name><![CDATA[Nils Hayat]]></name>
    
  </author>

  
  <entry>
    <title type="html"><![CDATA[From C declarators to Objective-C blocks syntax]]></title>
    <link href="http://nilsou.com/blog/2013/08/21/objective-c-blocks-syntax/"/>
    <updated>2013-08-21T11:30:00-04:00</updated>
    <id>http://nilsou.com/blog/2013/08/21/objective-c-blocks-syntax</id>
    <content type="html"><![CDATA[<p>In this post, I start with the simplest C declarator and build in complexity until we get to Objective-C blocks syntax. It took me a while to get block syntax but once you understand how it is organized and where it comes from, there is no looking in Google every time you need to declare a block anymore.</p>

<p>If you want to be able to write block declarations from the top of your head, read-on!</p>

<p>I strongly advise against reading this post in an RSS reader or read later service. It does heavy use of colors to explain things and these colors would not appear there.</p>

<!-- more -->


<h3>Declarators</h3>

<p>Variables in C (and by extension Objective-C) are declared using declarators.</p>

<p>A declarator has 2 roles:</p>

<ul>
<li>Specify the type of the variable (what the compiler should expect to find in that memory space)</li>
<li>Give that variable a name to make it available to the appropriate scope.</li>
</ul>


<p>Let&rsquo;s start with the most basic declarator:</p>

<pre align='center' style="font-size:1.5em; margin-bottom:1em;">
<font color="722CFD">int</font> <font color="2E6FFD">a</font>;
</pre>


<p>This is most likely the first line of C code you have ever written.</p>

<p><code><font color="722CFD">int</font></code> is a basic type and <code><font color="2E6FFD">a</font></code> is the variable name or identifier<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.</p>

<p>To read a declarator, you start from the identifier, then go right until you can&rsquo;t and then you start over from the left of the variable<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> (we&rsquo;ll explain why in the next section).</p>

<p>Here there is nothing to the right of our variable so it&rsquo;s straightforward: <code><font color="2E6FFD">a</font></code> is an <code><font color="722CFD">int</font></code>.</p>

<p>A declaration can only have <em>1</em> basic type and it&rsquo;s the left most word of the declarator.</p>

<p>Declarators can modify basic types using modifiers to create <em>derived types</em>. The 4 modifiers (3 from ANSI-C and one from <a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1451.pdf">Apple&rsquo;s proposed extension</a>) are <code><font color="DD2067">*</font></code>, <code><font color="66B132">[]</font></code>, <code><font color="FD9A00">()</font></code> and <code><font color="66CCFF">^</font></code>.</p>

<h4>The 3 ANSI-C modifiers</h4>

<h5>The pointer modifier <code><font color="DD2067">*</font></code></h5>

<pre align='center' style="font-size:1.5em; margin-bottom:1em;">
<font color="722CFD">int</font> <font color="DD2067">*</font><font color="2E6FFD">a</font>;
</pre>


<p>The basic type is still int and the name of the variable <code><font color="2E6FFD">a</font></code>. But the pointer modifier <code><font color="DD2067">*</font></code> comes to tell us that <code><font color="2E6FFD">a</font></code> is a <font color="DD2067">pointer to</font> an <code><font color="722CFD">int</font></code> instead of an <code><font color="722CFD">int</font></code>.</p>

<p>The <code><font color="DD2067">*</font></code> modifier is always to the left of the modified variable.</p>

<h5>The array modifier <code><font color="66B132">[]</font></code></h5>

<pre align='center' style="font-size:1.5em; margin-bottom:1em;">
<font color="722CFD">int</font> <font color="2E6FFD">a</font><font color="66B132">[]</font>;
</pre>


<p>Here we see that the array modifier <code><font color="66B132">[]</font></code> comes to tell us that <code><font color="2E6FFD">a</font></code> is now <font color="66B132">an array of</font> <code><font color="722CFD">int</font></code>s instead of a simple <code><font color="722CFD">int</font></code>. This can be completed by the dimension of the array e.g. <code><font color="722CFD">int</font> <font color="2E6FFD">a</font><font color="66B132">[</font>10<font color="66B132">]</font>;</code>.</p>

<p>The <code><font color="66B132">[]</font></code> modifier is always to the right of the modified variable.</p>

<h5>The function modifier <code><font color="FD9A00">()</font></code></h5>

<pre align='center' style="font-size:1.5em; margin-bottom:1em;">
<font color="722CFD">int</font> <font color="2E6FFD">f</font><font color="FD9A00">()</font>;
</pre>


<p>The function modifier <code><font color="FD9A00">()</font></code> comes to tell us that <code><font color="2E6FFD">f</font></code> is <font color="FD9A00">a function that returns</font> an <code><font color="722CFD">int</font></code>. This modifier can also specify the arguments that the function takes e.g. <code><font color="722CFD">int</font> <font color="2E6FFD">f</font><font color="FD9A00">(</font><font color="9A9A9A">long</font><font color="FD9A00">)</font>;</code> is <font color="FD9A00">a function that</font>  <font color="9A9A9A">takes a long as an argument and</font> <font color="FD9A00">returns</font> an int.</p>

<p>The <code><font color="FD9A00">()</font></code> modifier is always to the right of the modified variable.</p>

<h4>Composing modifiers</h4>

<h5>Pointers and arrays</h5>

<p>Modifiers can be composed to create more complex variable types. Similarly to how arithmetic operations are ordered by precedence (* and / are executed before + and &ndash;), modifiers are too. <code><font color="66B132">[]</font></code> and <code><font color="FD9A00">()</font></code> have higher precedence over <code><font color="DD2067">*</font></code> (and <code><font color="66CCFF">^</font></code>).
Since the 2 modifiers with higher precedence are written to the right of the variable, when reading complex declarator, <strong>you always start from the identifier and go right as long as possible</strong> then go left when you reach either the end of the declarator or a closing parenthesis.</p>

<pre align='center' style="font-size:1.5em; margin-bottom:1em;">
<font color="722CFD">int</font> <font color="DD2067">*</font><font color="2E6FFD">a</font><font color="66B132">[]</font>;
</pre>


<p>or as you can write it by adding parentheses to improve readability</p>

<pre align='center' style="font-size:1.5em; margin-bottom:1em;">
<font color="722CFD">int</font> <font color="DD2067">*</font>(<font color="2E6FFD">a</font><font color="66B132">[]</font>);
</pre>


<p>is <font color="66B132">an array of</font> pointers to an <code><font color="722CFD">int</font></code>.</p>

<p>But you might ask, what if I want to have a pointer to an array of ints? Well since <code><font color="DD2067">*</font></code> has lower precedence than <code><font color="66B132">[]</font></code>, you need to use parenthesis to force that precedence.</p>

<pre align='center' style="font-size:1.5em; margin-bottom:1em;">
<font color="722CFD">int</font> (<font color="DD2067">*</font><font color="2E6FFD">a</font>)<font color="66B132">[]</font>;
</pre>


<p>Here, <code><font color="2E6FFD">a</font></code> is a <font color="DD2067">pointer to</font> <font color="66B132">an array of</font> <code><font color="722CFD">int</font></code>s.</p>

<h5>Array and functions</h5>

<p>You cannot have an array of functions and a function cannot return an array or a function<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>.
A function can however take an array as an argument.</p>

<pre align='center' style="font-size:1.5em; margin-bottom:1em;">
<font color="722CFD">int</font> <font color="2E6FFD">f</font><font color="FD9A00">(</font><font color="722CFD">int</font> <font color="66B132">[</font>10<font color="66B132">]</font><font color="FD9A00">)</font>;
</pre>


<p>Here f is <font color="FD9A00">a function that </font> takes <font color="66B132">an array of</font> 10 <code><font color="722CFD">int</font></code>s as an argument and <font color="FD9A00">returns</font> an <code><font color="722CFD">int</font></code>.</p>

<h5>Pointers and functions</h5>

<pre align='center' style="font-size:1.5em; margin-bottom:1em;">
<font color="722CFD">int</font> <font color="DD2067">*</font><font color="2E6FFD">f</font><font color="FD9A00">()</font>;
<font color="722CFD">int</font> <font color="DD2067">*</font>(<font color="2E6FFD">f</font><font color="FD9A00">()</font>);
</pre>


<p>In both cases, <code><font color="2E6FFD">f</font></code> is <font color="FD9A00">a function that returns</font> a <font color="DD2067">pointer to</font> an <code><font color="722CFD">int</font></code>.</p>

<p>What if you want a pointer to a function? Parentheses!</p>

<pre align='center' style="font-size:1.5em; margin-bottom:1em;">
<font color="722CFD">int</font> (<font color="DD2067">*</font><font color="2E6FFD">f</font>)<font color="FD9A00">()</font>
</pre>


<p><code><font color="2E6FFD">f</font></code> is a <font color="DD2067">pointer to</font> <font color="FD9A00">a function that returns</font> an <code><font color="722CFD">int</font></code>.</p>

<h4>The block (or closure) pointer modifier <code><font color="66CCFF">^</font></code></h4>

<p>Apple introduced a 4th modifier in its <a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1451.pdf">proposed extension of the ANSI-C standard</a>: <code><font color="66CCFF">^</font></code>.
This modifier is called the block pointer modifier (or closure modifier as they were originally called). Blocks are very similar to pointers for functions. You declare a block the same way you would declare a pointer to a function.</p>

<p>The block pointer modifier can only be applied to a function (you cannot write <code><font color="722CFD">int</font> <font color="66CCFF">^</font><font color="2E6FFD">a</font>;</code> as this is not defined).</p>

<p>This is the reason why <code><font color="722CFD">int</font> <font color="66CCFF">^</font><font color="2E6FFD">b</font><font color="FD9A00">()</font></code> is illegal and will cause a compiler error: If you read this declarator using the precedence rules, b would be a function that returns a block pointer to an int. There is no such thing and this is why <strong>when declaring a block you need to always put the caret and the identifier in parentheses</strong>.</p>

<pre align='center' style="font-size:1.5em; margin-bottom:1em;">
<font color="722CFD">int</font> (<font color="66CCFF">^</font><font color="2E6FFD">b</font>)<font color="FD9A00">()</font>
</pre>


<p><code><font color="2E6FFD">b</font></code> is a <font color="66CCFF">block pointer to</font> <font color="FD9A00">a function that returns</font> an <code><font color="722CFD">int</font></code> or as abbreviated a <font color="66CCFF">block</font>  <font color="FD9A00">that returns</font>  an  <code><font color="722CFD">int</font><font color="DD2067"></font></code>.</p>

<p>You can of course specify the arguments that the block takes:</p>

<pre align='center' style="font-size:1.5em; margin-bottom:1em;">
<font color="722CFD">int</font> (<font color="66CCFF">^</font><font color="2E6FFD">b</font>)<font color="FD9A00">(</font><font color="9A9A9A">long</font><font color="FD9A00">)</font>
</pre>


<p>is a <font color="66CCFF">block</font> <font color="FD9A00">that</font> <font color="9A9A9A">takes a long as an argument</font> <font color="FD9A00">returns a</font> <code><font color="722CFD">int</font></code>.</p>

<p>This is how you where the syntax for block declarations comes from. Now you already know that there are other syntaxes that you need to remember in order to use blocks: the one used to define a block literal, and the one to pass the block to an Objective-C method.</p>

<h3>Abstract declarator</h3>

<p>A declarator is made up of 2 things: an abstract declarator in which you insert the identifier.</p>

<p>Abstract declarators are used in 3 cases in standard C:</p>

<ul>
<li><p>In casts: in <code>int *a; long *b = (long *) a;</code>, <code>(long *)</code> is an abstract declarator for a pointer to a <code>long</code>.</p></li>
<li><p>As arguments of sizeof(): <code>malloc(sizeof(long *));</code></p></li>
<li><p>When declaring argument types for a function: <code>int f(long *);</code></p></li>
</ul>


<p>Objective-C uses abstract declarators in one more place: when declaring arguments or return values for methods.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">long</span> <span class="o">**</span><span class="p">)</span><span class="nf">methodWithArgument:</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="nv">a</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here both <code>long **</code> and <code>int *</code> are abstract declarators.</p>

<p>So in order to use blocks as arguments or return values for Objective-C methods, we need to find the abstract declarator for these blocks. This is achieved by taking the declarator and removing the identifier.</p>

<p><code><font color="722CFD">int</font> (<font color="66CCFF">^</font><font color="2E6FFD">b</font>)<font color="FD9A00">()</font></code> becomes <code><font color="722CFD">int</font> (<font color="66CCFF">^</font>)<font color="FD9A00">()</font></code>  and <code><font color="722CFD">int</font> (<font color="66CCFF">^</font><font color="2E6FFD">b</font>)<font color="FD9A00">(</font><font color="9A9A9A">long</font><font color="FD9A00">)</font></code> becomes <code><font color="722CFD">int</font> (<font color="66CCFF">^</font>)<font color="FD9A00">(</font><font color="9A9A9A">long</font><font color="FD9A00">)</font></code>.</p>

<p>example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">methodWithArgument:</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="nv">block</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">anotherMethodWithArgument:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="kt">long</span> <span class="n">arg1</span><span class="p">))</span><span class="nv">block</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>While you don&rsquo;t have to name your block&rsquo;s arguments in these abstract declarators, it is a good idea to do it. It will give a good hint as to what the block expects as argument and Xcode autocomplete will make your life easier when using that method.</p>

<h3>Block literals</h3>

<p>When you write <code>int a = 2;</code>, <code>int a</code> is a declarator and <code>2</code> is a literal for an int.</p>

<p>The caret <code>^</code> is also used as a unary operator to transform a function implementation into a block<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup>. You don&rsquo;t need to specify the return type for the block (it is inferred from the return statement in that block) but you can.</p>

<p>Since this is the implementation of that block, you need to name your arguments here.</p>

<p>So for the block <code>int (^block)(long, long);</code>, a block literal would be:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">block</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="kt">long</span> <span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Conclusion</h3>

<p>As convoluted as it may seem, blocks syntax in Objective-C is built upon standard C syntax. A block in Objective-C is nothing more than a pointer to a function that captures its scope. Once you understand that and practice writing and reading a few blocks declaration, you&rsquo;ll find it much easier to apprehend.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>From <a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf">ANSI-C draft</a> page 35: <em>&ldquo;An identiﬁer can denote an object; a function; a tag or a member of a structure, union, or enumeration; a typedef name; a label name; a macro name; or a macro parameter&rdquo;</em><a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>Oddly enough, Microsoft, of all companies, has a good <a href="http://msdn.microsoft.com/en-us/library/1x82y1z4(v=vs.80).aspx">page</a> explaining the interpretation of complex declarators.<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
<li id="fn:3">
<p>From <a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf">ANSI-C draft</a> page 133: <em>&ldquo;A function declarator shall not specify a return type that is a function type or an array type.&rdquo;</em><a href="#fnref:3" rev="footnote">&#8617;</a></p></li>
<li id="fn:4">
<p>From <a href="http://clang.llvm.org/docs/BlockLanguageSpec.html#id5">Clang documentation</a>: <em>&ldquo;A Block literal expression produces a reference to a Block. It is introduced by the use of the ^ token as a unary operator.&rdquo;</em><a href="#fnref:4" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Xcode 5 finally makes Interface Builder a viable option for teams]]></title>
    <link href="http://nilsou.com/blog/2013/08/07/xcode-5-finally-makes-interface-builder-a-viable-option-for-teams/"/>
    <updated>2013-08-07T11:00:00-04:00</updated>
    <id>http://nilsou.com/blog/2013/08/07/xcode-5-finally-makes-interface-builder-a-viable-option-for-teams</id>
    <content type="html"><![CDATA[<p>Last week as I was merging code to my working branch, I noticed something I had rarely (<em>never?</em>) seen before:</p>

<p><img src="http://f.cl.ly/items/1m473i2p0B32263R0M2f/Screen%20Shot%202013-07-22%20at%204.27.14%20PM.png" alt="Auto-merging Home/KTHomeViewController.xib" /></p>

<p>Git had just <strong>auto-merged a xib file</strong> for me! I figured this must have something to do with Xcode 5 and its &ldquo;upgrading&rdquo; of xib files, so I started digging.</p>

<p>It turns out that the xib files generated by Xcode 5 are of a completely new kind. It seems that Apple started from scratch with this and the changes make xib files finally usable in teams of all sizes for the first time.</p>

<!-- more -->


<h3>Xcode 4 xib format</h3>

<p>To demonstrate the difference between the 2 file formats I have created a new xib file in Xcode 4 and put a bunch of views in it: A UIScrollView with UIButtons, UILabels and more in it, a UITextView etc.</p>

<p><img src="http://f.cl.ly/items/1Q1v313m0F1h3d0w3T2d/Screen%20Shot%202013-07-22%20at%204.19.34%20PM.png" alt="View in Interface Builder" /></p>

<p>After that I right clicked on the file in the project navigator and selected <code>Open As &gt; Source Code</code>. Here is what that file looked like under the hood:</p>

<p><a href="https://gist.github.com/nilsou/6057457">.xib file generated by Xcode 4</a> (you need to click &ldquo;File suppressed. Click to show.&rdquo; because github is being stupid)</p>

<p><strong>1108 lines</strong> for a rather simple view! That&rsquo;s a lot.</p>

<p>Try to make sense of the file, it&rsquo;s not intelligible at least not easily. This is the main reason why people don&rsquo;t like xib files and <a href="http://sam.roon.io/why-i-dont-use-interface-builder">don&rsquo;t use interface builder</a>.</p>

<p>It gets worse: the format is non-deterministic. Meaning that if you and I create exactly the same UI in Interface builder, we might (will) not have the same file content. This use to make xib files very difficult or even impossible to merge. This is the other big reason for people not to use xib files.</p>

<h3>Xcode 5 xib format</h3>

<p>Then I opened the same project in Xcode 5. When you open a xib file that was created in Xcode 4 in Xcode 5 you are prompted to upgrade the file to the new format. You want to only do it if all the people working on the project use Xcode 5 because the new files can&rsquo;t be opened by older versions of Xcode.</p>

<p><img src="http://f.cl.ly/items/2w0g1i0b293w3u103w1i/Screen%20Shot%202013-07-22%20at%204.48.19%20PM.png" alt="Upgrade &quot;View.xib&quot; to take advantage of Xcode 5 features?" /></p>

<p>I clicked <em>Upgrade</em> and then opened the xib file as source code again to see what had changed. Here is what it looked like.</p>

<p><a href="https://gist.github.com/nilsou/6057474">.xib file generated by Xcode 5</a> (again, click &ldquo;File suppressed. Click to show.&rdquo;)</p>

<p><strong>103 lines!</strong> The old file had more than 10 times as many lines! Now this is what I call a drastic reduction.</p>

<p>And look at it, it&rsquo;s actually <em>understandable</em>. The file now reflects the view hierarchy that you see in the left part of Interface Builder! With a little bit of practice you could even write that xml code. Ok, ok I am pushing it a little here.</p>

<p>On top of that, the code generated seems to be deterministic now. This means that with the same user interface in input it will generate the same xib file. This makes manual merging much easier if it is needed.</p>

<h3>Conclusion</h3>

<p>The best part is that this new file format is not only understandable by humans but git can also make sense of the changes happening and will now most of the time auto-merge your xib files for you!</p>

<p>Now if someone tells you that they don&rsquo;t want to use xib files, send them to this article, I don&rsquo;t think there are many reasons left not to use them.</p>

<p>This is not the only improvement that Xcode 5 brings to Interface Builder, for example, setting auto-layout constraints is now awesome whereas it was a pain before. If you have tried setting constraints in code you know that it is not a walk in the park.</p>

<p>Let me know what you think on <a href="http://twitter.com/nilsou">twitter</a>!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to have two versions of the same app on your device]]></title>
    <link href="http://nilsou.com/blog/2013/07/29/how-to-have-two-versions-of-the-same-app-on-your-device/"/>
    <updated>2013-07-29T07:59:00-04:00</updated>
    <id>http://nilsou.com/blog/2013/07/29/how-to-have-two-versions-of-the-same-app-on-your-device</id>
    <content type="html"><![CDATA[<p>You have <em>v1</em> of your great app in the App Store, and therefore on all your devices. You are now starting to work on <em>v1.1</em>. The problem is that if you just bump the version number and keep building/provisioning with your current settings, when you install it on your device, it will replace the App Store version.</p>

<p>In this article, I am going to explain how to get both the currently released version of your app and the development build you are working on the same device easily. I am also going to explain how to have 2 different icons for them so that you can tell them apart.</p>

<!--more-->


<h3>Create 2 different App IDs</h3>

<p><strong>Update:</strong> <em>You only need 2 different App IDs if you need to use things such as push notifications or iCloud. Otherwise you can use a wildcard profile with 2 different bundle IDs. Thanks <a href="http://twitter.com/alloy">@alloy</a> for the tip.</em></p>

<p>When you install an App, in order to determine if you are trying to install a new app or to update an app already installed, the device compares their App IDs.</p>

<p>So the first thing to do is to go in the provisioning center and create a second App ID for the development version of your app so that the device will be able to keep the two versions of your app.</p>

<p>If your App Store app has the App ID <code>com.mycompany.myapp</code> I suggest you create <code>com.mycompany.myapp-beta</code> or <code>com.mycompany.myapp-dev</code>.</p>

<p>While you&rsquo;re in there also create a provisioning profile for that new App ID.</p>

<h3>Create a different icon for the development version</h3>

<p>In order to differentiate the 2 versions when they are on my device, I use 2 different icons. The beta version has a black and yellow <em>work in progress</em> banner at the top left.</p>

<p><img src="http://f.cl.ly/items/1g0n2k3i2Z2f1u10423F/Beta-next-to-release.jpg" alt="Beta next to release" /></p>

<p>The first time I saw that technique used it was on a springboard screenshot of <a href="http://twitter.com/viticci">Federico Viticci</a>&rsquo;s phone where he had a development version of <a href="http://tapbots.com/software/tweetbot/">Tweetbot</a>.</p>

<p>I created a PSD template to create those development icons, here it is: <a href="http://cl.ly/3x1Y0s0q2m3T/download/App%20Icon%20Beta%20Overlay.psd">App-icon-beta-overlay</a></p>

<p>Name your icons <code>Icon.png</code>, <code>Icon@2x.png</code>, <code>Icon-beta.png</code> and <code>Icon-beta@2x.png</code>.</p>

<h3>Have separate Build configurations</h3>

<p>By default, Xcode creates 2 build configurations for you: <em>Debug</em> and <em>Release</em>. I like to add a third one, <em>AppStore</em>. I use them as follow:</p>

<ul>
<li>Debug: when I work and put the app on the device directly from Xcode.</li>
<li>Release: When I package the app as an ipa + plist and put it on our Over-the-air distribution system. (Similar to test flight but much simpler)</li>
<li>AppStore: I use this configuration when creating the builds that are submitted to the App Store.</li>
</ul>


<h3>Put it all together</h3>

<h4>User-Defined build settings</h4>

<p>Now we need to setup the project so tat it will use the correct App ID and icon for each configuration.</p>

<p>To do so, go in your project&rsquo;s Build Settings and scroll all the way down. Add a User-defined setting that you call <code>BUNDLE_IDENTIFIER</code> and another one that you call <code>APP_ICON_NAME</code>. Set the values for each build configuration as in the following screenshot:</p>

<p><img src="http://f.cl.ly/items/3v3T3W230B1v2K0M2m1c/Screen%20Shot%202013-07-23%20at%2011.12.16%20AM.png" alt="Project Settings screenshot" /></p>

<p>Now we need to tell Xcode to use these settings when building your app</p>

<h4>Info.plist</h4>

<p>Open the info.plist file for your project (It&rsquo;s in Supporting files and is called MyApp-Info.plist).</p>

<p>There under bundle identifier, replace the bundle identifier that you currently have with <code>${BUNDLE_IDENTIFIER}</code></p>

<p>Also open the Icon files drop down and make sure the 2 options you have are <code>${APP_ICON_NAME}@2x.png</code> and <code>${APP_ICON_NAME}.png</code>.</p>

<p>The <code>${…}</code> syntax is the pre-processor syntax: the first phase of any build starts with the pre-processor going over all the files and replacing these <code>${…}</code> with the values to what they are set.</p>

<h3>Conclusion</h3>

<p>This lets you with a project that will automatically use the beta App ID and icon when you are building for testing but that will also use the regular App ID and icon when you make a build for the App Store.</p>

<p>Using pre-processor macros you can also access those settings from your code to set different parameters for different configurations.</p>

<p>You can take it now step further and define more build configuration. Let&rsquo;s say your app connects to an API and you want some builds to point to the production server and some others to point to a development server, you can use this method to point them to the right URL and give them a different icon automatically!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Open source Objective-C code with Github and CocoaPods]]></title>
    <link href="http://nilsou.com/blog/2013/07/21/how-to-open-source-objective-c-code/"/>
    <updated>2013-07-21T16:33:00-04:00</updated>
    <id>http://nilsou.com/blog/2013/07/21/how-to-open-source-objective-c-code</id>
    <content type="html"><![CDATA[<p>Last week I decided to open source some classes that I have written and that I reuse often in apps so that other developers can benefit from them. This post has 3 parts: first I talk about how to format you code/project to make it useful to other developers. Then I explain how to put it on Github. And finally I describe what to do to make it available through <a href="http://cocoapods.org">CocoaPods</a>.</p>

<!-- more -->


<h3>Make that project look good</h3>

<h4>Clean up the code itself</h4>

<p>As always when writing code that other people are going to read, you want it to be as clean as possible. Here are a few tips:</p>

<ul>
<li>Removing all commented code that you have left in there.</li>
<li>Name your variables and methods with names that are legible and easy to understand.</li>
<li>Split big methods in multiple small methods (a good guideline is ~25 lines max per method)</li>
<li>Comment the hell of your header file. (This is the only thing that most people using your code will read)</li>
</ul>


<h4>Organize the project</h4>

<p>Often you want to share just a few classes but it is a good idea to include a Demo project so that people can understand how your classes are intended to be used.</p>

<p>Have the files of interest in a folder and the files for the demo project in a different one so as not to confuse your user.</p>

<p>You want the project file to reflect the organization of the project folder:</p>

<p><img src="http://farm8.staticflickr.com/7397/9340191112_5dda8d0ecd_o.png" alt="project organization" /></p>

<p><img src="http://farm4.staticflickr.com/3692/9337404169_20a9e4740a_o.png" alt="project folder" /></p>

<p>Here the class I want to share is <code>NHAlignmentLayout</code> the rest of the files are there to demonstrate how to use it.</p>

<h4>Include a README</h4>

<p>Write an explicit readme with code samples and even screenshots, that will be the homepage for your repo and will likely be the decisive point for if someone who comes to your project will end up using it or not.
Include explicit instructions on how to install you classes (Most likely using <a href="http://cocoapods.org">CocoaPods</a>.</p>

<h4>Include a LICENSE</h4>

<p>When you open source some of your work, you need to define what people can and cannot do with it. This is the role of a license. There are many open-source licenses such as MIT, GNU, and BSD… You can find which one is best for you by going to <a href="http://choosealicense.com/">Choose A License</a>. This site made by Github will help you find the best license for you.</p>

<h3>Put it on Github</h3>

<h4>Create the Repository</h4>

<p>Go to your Github account and create a new repository for your project. Name it with a name that makes sense; don&rsquo;t name it <code>XXSomethingDemo</code> but rather <code>XXSomething</code> as this is what everybody cares about.
Check the option to add a .gitignore file and choose Objective-C.</p>

<h4>Clone the empty repository on your computer</h4>

<p>Clone the repo you just created in a temp folder on your mac. You don&rsquo;t want to add the repo as a remote for your current git repo in order to start with a fresh repo and a beautiful <em>Initial Commit</em>.</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/nilsou/NHAlignmentLayout.git</span></code></pre></td></tr></table></div></figure>


<h4>Copy and Paste your project to that folder</h4>

<p>Copy and paste your project files to that folder. You want to have the .xcodeproj file at the root of the repo. Do not put everything in a folder as the only thing it will do is annoy you users.</p>

<h4>Commit and Push</h4>

<p>Add your newly added files to git, commit and push to github.</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>git add .
</span><span class='line'>git commit -a -m "Initial Commit"
</span><span class='line'>git push origin master</span></code></pre></td></tr></table></div></figure>


<p>Your project is now open-sourced and people can start using it! But for it to be really easy to use and install you want to make it available on <a href="http://cocoapods.org">CocoaPods</a>.</p>

<h3>CocoaPods</h3>

<p>CocoaPods is to Objective-C what gems are to Ruby. You can list in the root of your project the &ldquo;pods&rdquo; you need and CocoaPods will download them and install them for you.</p>

<p>Start by installing CocoaPods if it is not already installed on your mac.</p>

<h4>Create the .podspec file.</h4>

<p>You need to create at the root of your repo a file that is a recipe for CocoaPods to use your classes.</p>

<p>Navigate to your project folder in a terminal window and ask CocoaPods to create a staring pod spec for you:</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>pod spec create NHSlidingController</span></code></pre></td></tr></table></div></figure>


<p>Open that file and start filling it with the information on your project.</p>

<p>It is important to use a version number. I usually start with 0.1.0 but this is up to you.</p>

<p>The <code>source</code> line is also important it is the line that tells CocoaPods where your project resides on the internet.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s2">&quot;https://github.com/nilsou/NHAlignmentFlowLayout.git&quot;</span><span class="p">,</span> <span class="ss">:tag</span> <span class="o">=&gt;</span> <span class="s2">&quot;0.1.0&quot;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You also need to tell CocoaPods which files in your repo are relevant so that it does not copy any unneeded demo/example file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">source_files</span> <span class="o">=</span> <span class="s1">&#39;NHAlignmentFlowLayout/*.{h,m}&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Validate the .podspec file</h4>

<p>Then we are going to verify the validity of your .podspec file.</p>

<p>You noticed that in <code>s.source</code> we point to a specific tag in our repo. You need to create a tag for CocoaPods to be able to find your code. A tag is an absolute reference across branches to a state of your code in time. They&rsquo;re often used for versioning and that&rsquo;s what CocoaPods use them for.</p>

<p>Create the tag locally and then push it to Github. In your terminal window enter:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">git</span> <span class="n">tag</span> <span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;0.1.0 - Initial release&quot;</span>
</span><span class='line'><span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">master</span> <span class="o">-</span><span class="n">tags</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then you want to make sure that you .podspec file works. To do so use the <code>pod spec lint command</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pod</span> <span class="n">spec</span> <span class="n">lint</span> <span class="no">NHAlignmentFlowLayout</span><span class="o">.</span><span class="n">podspec</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will try to download the pod you just created from the address you supplied in the podspec file. You should get something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">NHAlignmentFlowLayout</span><span class="o">.</span><span class="n">podspec</span> <span class="n">passed</span> <span class="n">validation</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Commit that file to git and push it to Github.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">git</span> <span class="n">add</span> <span class="o">.</span>
</span><span class='line'><span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;Added .podspec file&quot;</span>
</span><span class='line'><span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">master</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Add you .podspec to the master Specs repo</h4>

<p>All .podspecs files are kept in a central to repo called Specs. You need to fork that repo, add your pod specs to it and then issue a pull request for it to be merged. Don’t worry it&rsquo;s really easy.</p>

<h5>Fork the Specs Repo and clone it to your mac</h5>

<p>Go to the <a href="https://github.com/CocoaPods/Specs">Specs Github Repo</a> and Press the Fork Button on the top right corner. This will create a copy of the Specs repo in your account.</p>

<p>Clone the forked repo on you computer to be able to modify it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">git</span> <span class="nb">clone</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">nilsou</span><span class="o">/</span><span class="no">Specs</span><span class="o">.</span><span class="n">git</span>
</span></code></pre></td></tr></table></div></figure>


<h5>Add your .podspec and push it to your fork</h5>

<p>Create a folder named with the name of you pod. for me it is <code>NHAlignmentLayout</code>
Create a subfolder with the name of your tag <code>0.1.0</code> for me.
Copy the .podspec file you created earlier in that folder.</p>

<p>Commit and push your changes to you forked repo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">git</span> <span class="n">add</span> <span class="o">.</span>
</span><span class='line'><span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;Added NHAlignmentLayout&quot;</span>
</span><span class='line'><span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">master</span>
</span></code></pre></td></tr></table></div></figure>


<h5>Create the pull request</h5>

<p>Go to the forked Specs repo on github. Press the Comparison button, next to the name of the current branch. :</p>

<p><img src="http://farm6.staticflickr.com/5479/9340191074_1a6f3ae4d0_o.png" alt="Pull request button" /></p>

<p>This will initiate the comparison between your current repo and the original repo.</p>

<p>Review the changes, you should see the content of you .podspec file in green, meaning that this was added.</p>

<p>Press the <code>Click to create a pull request for this comparison</code> Button.</p>

<p><img src="http://farm3.staticflickr.com/2874/9337404161_38396a3a23_o.png" alt="Click to create a pull request for this comparison" /></p>

<p>This will send a pull request to the owners of the Specs repo. They are usually <em>extremely</em> quick to merge the pull request!</p>

<p>Once your pull request is approved you can start using your pod in other projects.</p>

<p>Now, go share your code!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to turn a PNG Sequence into a video with the correct colors for the iPad]]></title>
    <link href="http://nilsou.com/blog/2013/01/10/how-to-turn-a-png-sequence-into-a-video-with-the-correct-colors-for-the-ipad/"/>
    <updated>2013-01-10T08:33:00-05:00</updated>
    <id>http://nilsou.com/blog/2013/01/10/how-to-turn-a-png-sequence-into-a-video-with-the-correct-colors-for-the-ipad</id>
    <content type="html"><![CDATA[<p>A few days ago, I was asked to embed videos in an iPad app and to have the video player be &ldquo;invisible&rdquo; to the user. This means that we extracted the part of the background for the view where the video would go and used it as the background for creating the video (in After Effects). Everything looked great and I had a perfectly invisible experience in the simulator.</p>

<p>Then I decided to test on an actual iPad. This is when I realized that the videos looked completely different from the background. I had a color management problem. We tried every export settings we could find in After Effects, nothing would work.</p>

<!-- more -->


<p>The solution that I found was to have After Effect export the animation as a PNG Sequence + audio file and then to generate an mp4 video from these assets using ffmpeg.</p>

<p>This post explains the settings I found that worked for me.</p>

<h3>The Basics</h3>

<ol>
<li>Install the latest version of ffmpeg (you can get it from here <a href="http://ffmpegmac.net/">ffmpegmac</a>)</li>
<li>the PNG sequence has to be named something like imagexxxxx.png where xxxxx is the frame number with a constant number of digits (00001, 00002, … , 99999)</li>
<li><p>Open a terminal window and run the following command:</p>

<pre><code> ffmpeg  -f image2
         -i ./path/to/images/imaged.png \
         -i ./path/to/audio/audio.mp3 \
         -r 30 \
         -vcodec libx264 \
         -pix_fmt yuv420p \
         -acodec libvo_aacenc \
         -ab 128k \
         ./path/to/output/output.mp4
</code></pre>

Let me explain the parameters here:

<ul>
<li><code>-i xxx</code> is to specify the <em>input</em> files (both the image sequence with the  which means &ldquo;number with 5 exactly digits&rdquo; and the audio file)</li>
<li><code>-r</code> is to specify the frame rate at which ffmpeg is going to interpret the png sequence</li>
<li><code>-vcodec</code> is the video codec</li>
<li><code>-pix_fmt yuv420p</code> is required so that the output h264 mp4 file is compatible with Apple implementation of the codec. I fyou don&rsquo;t put this, the video won&rsquo;t play in quicktime or on an iOS device.</li>
<li><code>-acodec</code> is the audio codec</li>
<li><code>-ab</code> is the audio bitrate</li>
<li>finallly you can use <code>-o</code> to specify the output name but it can be omitted (the last parameter is the output name in this case)</li>
</ul>
</li>
</ol>


<p>The video created with this method will play on iOS devices and will match the color of images you might have next to it.</p>

<h3>Automate it</h3>

<p>if you have a number of sequences you have to convert, you can use a for loop to let the terminal do all the work for you.</p>

<ol>
<li>first of all have your png sequences in separate folders named videoY where Y is the video number etc…</li>
<li>In each folder, have the png named imageX_xxxxx where Y is the video number and xxxxx is the frame number with a constant number of digits (00001, 00002, … , 99999)</li>
<li>make sure you run bash as your shell (other shells have different syntax for loops)</li>
<li><p>Run the following command:</p>

<pre><code> for i in 1 2 3 4 5 6 7;
 do
 ffmpeg  -f image2 \
         -i ./video$i/image${i}_d.png \
         -i ./video$i/audio.mp3 \
         -r 30 \
         -vcodec libx264 \
         -pix_fmt yuv420p \
         -acodec libvo_aacenc \
         -ab 128k \
         ./video$i/output$i.mp4;
 done
</code></pre></li>
<li><p>Grab a beer and watch the magic happen</p></li>
</ol>

]]></content>
  </entry>
  
</feed>
